# ssg-kiosk-photo-player

{
  "ID": "690666c1cbd4230001cc1942",
  "updated_at": "2025-11-01T20:00:01.157906574Z",
  "created_at": "2025-11-01T20:00:01.157906434Z",
  "user_id": "6485a69b6b608800088d9aca",
  "external_id": "KVARICHM156",
  "name": "Fan District - Richmond, VA",
  "latitude": 37.554,
  "longitude": -77.466,
  "altitude": 67,
  "rank": 10,
  "source_type": 5
}



# ğŸ“ Project Structure & Rationale

This project is structured as a **monorepo** containing:

* a backend server (Node/Express)
* Chromecast receiver code
* CLI tools
* a future mobile control app (Expo/React Native)
* static web pages
* external media libraries
* runtime working directories
* infrastructure files (Docker, Compose, config)

The layout is intentionally opinionated: every top-level directory has a clear purpose, and nothing overlaps.

```
project-root/
â”œâ”€â”€ config/               # Static config for services (e.g., mediamtx.yml)
â”œâ”€â”€ database/             # Long-term persistent config/state (e.g., config.yaml)
â”œâ”€â”€ media/                # Real photo/video/movie libraries (NFS/host-mounted)
â”œâ”€â”€ runtime/              # Volatile cache + logs created at runtime
â”œâ”€â”€ public/               # Static frontend HTML served by the backend
â”œâ”€â”€ pages/                # Additional public-facing HTML content
â”œâ”€â”€ scripts/              # Dev/ops helper scripts (bash, node test scripts)
â”œâ”€â”€ src/                  # All source code (backend, core, CLI, chromecast, mobile)
â”œâ”€â”€ docker-compose.yml    # Container orchestration
â”œâ”€â”€ Dockerfile            # Main app container build recipe
â””â”€â”€ Makefile              # Developer convenience commands
```

Below is a description of each category and the reasoning behind its design.

---

## ğŸŸ¦ `config/` â€“ Static, Host-Configured Service Files

Contains files like:

* `mediamtx.yml`

This directory is:

* **mounted read-only** into Docker
* never modified by application code
* version-controlled, reproducible, and environment-specific

Think of it as `etc/` in a Linux system.

---

## ğŸŸ© `database/` â€“ Persistent Application Configuration (YAML â†’ future DB)

Contains:

* `config.yaml` â€” slideshow definitions
* future SQLite DB / metadata store

Rationale:

* "Config that changes over time" must **not** live in `src/`
* must be **backed up** separately from runtime caches
* but must **not** be baked into Docker images

This separates *static config* (in `config/`) from *dynamic project data* (in `database/`).

Later, this folder may contain:

* `config.db`
* `slides.db`
* device assignment records
* Chromecast playlist history

---

## ğŸ `media/` â€“ Real User Content (not committed to Git)

This directory contains the real photo/video/movie libraries:

```
media/
â”œâ”€â”€ photos/
â”œâ”€â”€ videos/
â”œâ”€â”€ movies/
â””â”€â”€ tv/
```

Rationale:

* These can easily be **tens or hundreds of gigabytes**
* They are **mounted into Docker containers**
* They must be **outside the image**
* They are optional per-machine and vary by deployment
* `.gitkeep` files ensure directory structure remains

This directory mirrors what your QNAP/NFS filesystems look like.

---

## ğŸ”¥ `runtime/` â€“ Volatile, Auto-Generated Data

```
runtime/
â”œâ”€â”€ cache/   # resized images, thumbnails, GD/OD image pulls, temp assets
â””â”€â”€ logs/    # runtime logs
```

Everything here:

* is generated by the backend at runtime
* is **safe to delete at any time**
* is never committed to Git
* is excluded from Docker builds
* can be cleared with `make clean` or via cron

This separation prevents accidental commit/push of huge caches and lets the system be reset safely.

It is the equivalent of `/var/cache` and `/var/log` in Linux.

---

## âš™ï¸ `src/` â€“ All Source Code

```
src/
â”œâ”€â”€ backend/              # Node/Express server: API routes, weather, Sonos, slideshow logic
â”œâ”€â”€ chromecast-receiver/  # Custom Chromecast receiver app
â”œâ”€â”€ core/                 # Device discovery, slideshow orchestration logic
â”œâ”€â”€ cli/                  # Local CLI that wraps core APIs
â””â”€â”€ mobile/               # Future Expo/React Native control app
```

This folder contains **all code** that implements functionality.

### Why these subfolders exist:

* `backend/`
  Isolates the server API and routing logic.

* `core/`
  Houses business logic shared by the backend, CLI, and future mobile app.
  (E.g., â€œdiscover chromecastsâ€, â€œassign slideshow to deviceâ€, etc.)

* `chromecast-receiver/`
  The Chromecast HTML/JS app that devices load.

* `cli/`
  Local, developer-friendly commands for testing orchestrations.

* `mobile/`
  Placeholder for upcoming control app.

This structure keeps concerns isolated and avoids mixing HTTP endpoints with business logic.

---

## ğŸŸ§ `public/` and `pages/` â€“ Static Frontend

These directories contain HTML files served directly by Express.

* `public/index.html` â€” main front-end kiosk viewer
* `public/pages/` â€” standalone HTML tools/pages
* `pages/` â€” older or utility pages (you may consolidate into `public/pages` later)

Static files do not belong in `src/backend`, because they are not part of the server logic itself.

---

## ğŸ§° `scripts/` â€“ Host Utility Scripts

Includes:

* `discover-ms.sh`
* `kiosk.sh`
* `sonos-test.js`

These are **developer/ops scripts**, not application code.
They remain at the repo root because they are tools for *you*, not part of the runtime app.

If more scripts appear later, consider:

```
scripts/maintenance/
scripts/dev/
scripts/sonos/
```

---

## ğŸ³ Docker: Why `media/` and `runtime/` Are Excluded

Your `.dockerignore` explicitly excludes:

* `media/`
* `runtime/`

Reasoning:

* Keeps build context tiny
* Prevents gigabytes of files from being copied into the Docker image
* Ensures the container uses host-mounted volumes for real data
* Ensures cache/logs are always fresh

This is required for fast CI/CD and consistent reproducible images.

---

# ğŸš€ Summary: Key Principles Behind This Structure

1. **App code lives in `src/`**
   Everything that *runs* or is *compiled* goes there.

2. **User/media assets live in `media/`**
   Always mounted, never copied into Docker.

3. **Ephemeral data lives in `runtime/`**
   Safe to delete, never in Git, never in images.

4. **Static service config lives in `config/`**
   Versioned, file-based configuration for infrastructure.

5. **Dynamic app configuration persists in `database/`**
   (Today YAML, tomorrow SQLite.)

6. **Scripts live in `scripts/`**
   Never mixed with production code.

7. **Everything is volume-mounted correctly in Docker Compose**
   Your compose file now maps the correct portions of the filesystem.

